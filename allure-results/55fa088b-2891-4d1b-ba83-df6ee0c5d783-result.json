{"name": "test_login_y_cambio_idioma", "status": "broken", "statusDetails": {"message": "selenium.common.exceptions.NoSuchWindowException: Message: no such window: target window already closed\nfrom unknown error: web view not found\n  (Session info: chrome=142.0.7444.60)\nStacktrace:\nSymbols not available. Dumping unresolved backtrace:\n\t0x7ff626c67a35\n\t0x7ff626c67a90\n\t0x7ff6269e16ad\n\t0x7ff6269b8e01\n\t0x7ff626a6a0be\n\t0x7ff626a8b222\n\t0x7ff626a2b068\n\t0x7ff626a2be93\n\t0x7ff626f229d0\n\t0x7ff626f1ce50\n\t0x7ff626f3cc45\n\t0x7ff626c830ce\n\t0x7ff626c8adbf\n\t0x7ff626c70c14\n\t0x7ff626c70dcf\n\t0x7ff626c56828\n\t0x7ffed862e8d7\n\t0x7ffed9e2c53c", "trace": "self = <test_case_3.TestCase3 object at 0x000001CF52C77ED0>, driver = <selenium.webdriver.chrome.webdriver.WebDriver (session=\"01e2f0b9985a6c8bf7733afd7190d899\")>\n\n    @pytest.mark.case3\n    def test_login_y_cambio_idioma(self, driver):\n        \"\"\"LOGIN COMPLETO Y CAMBIO DE IDIOMA A FRANCÃ‰S DESPUÃ‰S DEL LOGIN\"\"\"\n    \n        logger.info(\"=== INICIANDO: LOGIN COMPLETO Y CAMBIO DE IDIOMA ===\")\n    \n        # 1. Navegar a la URL principal\n        logger.info(\"ðŸ“ PASO 1: Navegando a la URL principal...\")\n        home_page = HomePage(driver)\n        home_page.navigate_to(\"https://nuxqa3.avtest.ink/\")\n    \n        # Esperar carga completa\n        time.sleep(8)\n        home_page.take_screenshot(\"01_pagina_principal.png\")\n        logger.info(\"âœ… PÃ¡gina principal cargada correctamente\")\n    \n        # Guardar ventana principal\n        main_window = driver.current_window_handle\n        logger.info(f\"ðŸ“± Ventana principal: {main_window}\")\n    \n        # 2. Buscar y hacer click en el botÃ³n de login\n        logger.info(\"ðŸ–±ï¸ PASO 2: Buscando y haciendo click en botÃ³n de login...\")\n    \n        try:\n            login_btn = None\n    \n            # Primero intentar selectores especÃ­ficos\n            selectores_login = [\n                (By.CSS_SELECTOR, \"button[data-cy='login']\"),\n                (By.CSS_SELECTOR, \"button[class*='login']\"),\n                (By.CSS_SELECTOR, \"button[class*='auth']\"),\n                (By.XPATH, \"//button[contains(text(), 'Iniciar sesiÃ³n')]\"),\n                (By.XPATH, \"//button[contains(text(), 'Iniciar')]\"),\n                (By.XPATH, \"//button[contains(text(), 'Login')]\"),\n                (By.XPATH, \"//button[contains(text(), 'Sign in')]\")\n            ]\n    \n            for selector_type, selector_value in selectores_login:\n                try:\n                    logger.info(f\"ðŸ” Probando selector: {selector_value}\")\n                    elemento = driver.find_element(selector_type, selector_value)\n                    if elemento.is_displayed() and elemento.is_enabled():\n                        login_btn = elemento\n                        logger.info(f\"âœ… BotÃ³n de login encontrado: {selector_value}\")\n                        logger.info(f\"ðŸ“ Texto: '{elemento.text}'\")\n                        break\n                except Exception as e:\n                    logger.info(f\"âŒ Selector no funciona: {selector_value}\")\n                    continue\n    \n            # Si no encontramos con selectores especÃ­ficos, buscar en todos los botones\n            if not login_btn:\n                logger.info(\"ðŸ” Buscando en todos los botones...\")\n                all_buttons = driver.find_elements(By.TAG_NAME, \"button\")\n                logger.info(f\"ðŸ” Total de botones: {len(all_buttons)}\")\n    \n                for i, btn in enumerate(all_buttons):\n                    try:\n                        if btn.is_displayed() and btn.is_enabled():\n                            btn_class = btn.get_attribute('class') or ''\n                            btn_text = btn.text or ''\n    \n                            logger.info(f\"  BotÃ³n {i}: '{btn_text}' - Clase: '{btn_class}'\")\n    \n                            if any(keyword in btn_text.lower() for keyword in ['iniciar', 'login', 'sesiÃ³n', 'sign']) or \\\n                               any(keyword in btn_class.lower() for keyword in ['login', 'auth']):\n                                login_btn = btn\n                                logger.info(f\"ðŸŽ¯ Posible botÃ³n de login: '{btn_text}'\")\n                                break\n                    except Exception as e:\n                        logger.info(f\"âŒ Error con botÃ³n {i}: {e}\")\n    \n            if login_btn:\n                logger.info(\"ðŸ–±ï¸ Haciendo click en botÃ³n de login...\")\n                home_page.click_element(login_btn)\n                logger.info(\"âœ… Click en botÃ³n de login realizado\")\n            else:\n                raise Exception(\"No se pudo encontrar ningÃºn botÃ³n de login viable\")\n    \n        except Exception as e:\n            logger.error(f\"âŒ Error con botÃ³n de login: {e}\")\n            home_page.take_screenshot(\"error_boton_login.png\")\n            assert False, f\"No se pudo encontrar el botÃ³n de login: {e}\"\n    \n        # 3. MANEJO DE VENTANAS/MODAL DESPUÃ‰S DEL CLICK EN LOGIN\n        logger.info(\"ðŸ”„ PASO 3: Manejando ventana/modal despuÃ©s del login...\")\n    \n        time.sleep(5)\n    \n        # Verificar si hay nuevas ventanas\n        all_windows = driver.window_handles\n        logger.info(f\"ðŸ“± Ventanas abiertas: {len(all_windows)}\")\n    \n        if len(all_windows) > 1:\n            # Cambiar a la nueva ventana\n            new_window = [window for window in all_windows if window != main_window][0]\n            driver.switch_to.window(new_window)\n            logger.info(f\"âœ… Cambiado a nueva ventana: {new_window}\")\n        else:\n            logger.info(\"â„¹ï¸  No hay nuevas ventanas, puede ser un modal\")\n    \n        # Tomar screenshot del estado actual\n        current_url = driver.current_url\n        logger.info(f\"ðŸŒ URL actual: {current_url}\")\n        home_page.take_screenshot(\"02_despues_click_login.png\")\n    \n        # 4. ESPERAR A QUE CARGUE EL FORMULARIO DE LOGIN\n        logger.info(\"â³ PASO 4: Esperando a que cargue el formulario de login...\")\n        time.sleep(5)\n    \n        # 5. BUSCAR FORMULARIO DE LOGIN EN DIFERENTES UBICACIONES\n        logger.info(\"ðŸ” PASO 5: Buscando formulario de login...\")\n    \n        # Estrategia 1: Buscar en la pÃ¡gina actual\n        username_field = self._buscar_campo_usuario(driver, home_page)\n    \n        # Estrategia 2: Si no encuentra, buscar en iframes\n        if not username_field:\n            logger.info(\"ðŸ” Buscando en iframes...\")\n            username_field = self._buscar_en_iframes(driver, home_page)\n    \n        # Estrategia 3: Si todavÃ­a no encuentra, verificar si estamos en pÃ¡gina diferente\n        if not username_field:\n            logger.info(\"ðŸ” Verificando si estamos en pÃ¡gina de login...\")\n            if 'login' in current_url.lower() or 'auth' in current_url.lower():\n                logger.info(\"âœ… Estamos en pÃ¡gina de login, reintentando bÃºsqueda...\")\n                username_field = self._buscar_campo_usuario(driver, home_page, True)\n    \n        if not username_field:\n            # DEBUG: Mostrar todos los inputs disponibles\n            logger.info(\"ðŸ” DEBUG: Mostrando todos los inputs disponibles...\")\n            all_inputs = driver.find_elements(By.TAG_NAME, \"input\")\n            logger.info(f\"ðŸ” Total de inputs: {len(all_inputs)}\")\n    \n            for i, inp in enumerate(all_inputs):\n                try:\n                    inp_type = inp.get_attribute('type') or ''\n                    inp_id = inp.get_attribute('id') or ''\n                    inp_name = inp.get_attribute('name') or ''\n                    inp_placeholder = inp.get_attribute('placeholder') or ''\n    \n                    logger.info(f\"  Input {i}:\")\n                    logger.info(f\"    Tipo: {inp_type}\")\n                    logger.info(f\"    ID: {inp_id}\")\n                    logger.info(f\"    Name: {inp_name}\")\n                    logger.info(f\"    Placeholder: {inp_placeholder}\")\n                    logger.info(f\"    Visible: {inp.is_displayed()}\")\n                except Exception as e:\n                    logger.error(f\"âŒ Error con input {i}: {e}\")\n    \n            raise Exception(\"No se pudo encontrar campo de usuario despuÃ©s de bÃºsqueda exhaustiva\")\n    \n        # 6. LLENAR CAMPO DE USUARIO\n        logger.info(\"ðŸ‘¤ PASO 6: Llenando campo de usuario...\")\n    \n        try:\n            home_page.click_element(username_field)\n            username_field.clear()\n            usuario = \"21734198706\"\n            username_field.send_keys(usuario)\n            logger.info(f\"âœ… Usuario ingresado: {usuario}\")\n    \n            # Verificar\n            texto_ingresado = username_field.get_attribute('value')\n            if texto_ingresado == usuario:\n                logger.info(\"âœ… Usuario verificado correctamente\")\n            else:\n                logger.warning(f\"âš ï¸ Texto en campo: '{texto_ingresado}'\")\n    \n            home_page.take_screenshot(\"03_usuario_ingresado.png\")\n    \n        except Exception as e:\n            logger.error(f\"âŒ Error llenando campo usuario: {e}\")\n            home_page.take_screenshot(\"error_campo_usuario.png\")\n            assert False, f\"No se pudo llenar campo de usuario: {e}\"\n    \n        # 7. BUSCAR Y LLENAR CAMPO DE CONTRASEÃ‘A\n        logger.info(\"ðŸ” PASO 7: Buscando y llenando campo de contraseÃ±a...\")\n    \n        try:\n            password_field = None\n            selectores_password = [\n                (By.ID, \"u-password\"),\n                (By.CSS_SELECTOR, \"input[type='password']\"),\n                (By.CSS_SELECTOR, \"input[name='new-password']\"),\n                (By.CSS_SELECTOR, \"input[placeholder*='ContraseÃ±a']\"),\n                (By.CSS_SELECTOR, \"input[placeholder*='Password']\")\n            ]\n    \n            for selector_type, selector_value in selectores_password:\n                try:\n                    elemento = driver.find_element(selector_type, selector_value)\n                    if elemento.is_displayed() and elemento.is_enabled():\n                        password_field = elemento\n                        logger.info(f\"âœ… Campo contraseÃ±a: {selector_value}\")\n                        break\n                except:\n                    continue\n    \n            if not password_field:\n                # Buscar cerca del campo de usuario\n                logger.info(\"ðŸ” Buscando campo contraseÃ±a cerca del usuario...\")\n                try:\n                    # Buscar siguiente input despuÃ©s del username\n                    password_fields = driver.find_elements(By.CSS_SELECTOR, \"input[type='password']\")\n                    for pwd in password_fields:\n                        if pwd.is_displayed():\n                            password_field = pwd\n                            break\n                except:\n                    pass\n    \n            if password_field:\n                home_page.click_element(password_field)\n                password_field.clear()\n                contraseÃ±a = \"Lifemiles1\"\n                password_field.send_keys(contraseÃ±a)\n                logger.info(\"âœ… ContraseÃ±a ingresada\")\n                home_page.take_screenshot(\"04_contrasena_ingresada.png\")\n            else:\n                raise Exception(\"No se pudo encontrar campo de contraseÃ±a\")\n    \n        except Exception as e:\n            logger.error(f\"âŒ Error con campo contraseÃ±a: {e}\")\n            home_page.take_screenshot(\"error_campo_contrasena.png\")\n            assert False, f\"No se pudo llenar campo de contraseÃ±a: {e}\"\n    \n        # 8. HACER LOGIN\n        logger.info(\"ðŸ–±ï¸ PASO 8: Haciendo login...\")\n    \n        try:\n            submit_button = None\n            selectores_submit = [\n                (By.ID, \"Login-confirm\"),\n                (By.CSS_SELECTOR, \"button[data-cy='lmSubmit']\"),\n                (By.CSS_SELECTOR, \"button[type='submit']\"),\n                (By.XPATH, \"//button[contains(text(), 'Iniciar sesiÃ³n')]\"),\n                (By.XPATH, \"//button[contains(text(), 'Iniciar')]\"),\n                (By.XPATH, \"//button[contains(text(), 'Login')]\")\n            ]\n    \n            for selector_type, selector_value in selectores_submit:\n                try:\n                    elemento = driver.find_element(selector_type, selector_value)\n                    if elemento.is_displayed() and elemento.is_enabled():\n                        submit_button = elemento\n                        logger.info(f\"âœ… BotÃ³n submit: {selector_value}\")\n                        break\n                except:\n                    continue\n    \n            if submit_button:\n                home_page.take_screenshot(\"05_antes_del_login.png\")\n                home_page.click_element(submit_button)\n                logger.info(\"âœ… Click en botÃ³n de login realizado\")\n    \n                # Esperar login\n                logger.info(\"â³ Esperando 15 segundos para login...\")\n                time.sleep(15)\n    \n                # Si hay mÃºltiples ventanas, volver a la principal\n                if len(driver.window_handles) > 1:\n                    driver.switch_to.window(main_window)\n                    logger.info(\"âœ… Volviendo a ventana principal\")\n    \n                home_page.take_screenshot(\"06_despues_del_login.png\")\n                logger.info(\"âœ… Login procesado\")\n            else:\n                raise Exception(\"No se pudo encontrar botÃ³n de submit\")\n    \n        except Exception as e:\n            logger.error(f\"âŒ Error con botÃ³n submit: {e}\")\n            home_page.take_screenshot(\"error_boton_submit.png\")\n            assert False, f\"No se pudo hacer login: {e}\"\n    \n        # 9. VERIFICAR LOGIN EXITOSO\n        logger.info(\"ðŸ” PASO 9: Verificando login exitoso...\")\n    \n>       current_url = driver.current_url\n\ntests\\test_case_3.py:293: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\nvenv\\Lib\\site-packages\\selenium\\webdriver\\remote\\webdriver.py:436: in current_url\n    return self.execute(Command.GET_CURRENT_URL)[\"value\"]\nvenv\\Lib\\site-packages\\selenium\\webdriver\\remote\\webdriver.py:346: in execute\n    self.error_handler.check_response(response)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <selenium.webdriver.remote.errorhandler.ErrorHandler object at 0x000001CF52DE4590>\nresponse = {'status': 404, 'value': '{\"value\":{\"error\":\"no such window\",\"message\":\"no such window: target window already closed\\\\...ff626c8adbf\\\\n\\\\t0x7ff626c70c14\\\\n\\\\t0x7ff626c70dcf\\\\n\\\\t0x7ff626c56828\\\\n\\\\t0x7ffed862e8d7\\\\n\\\\t0x7ffed9e2c53c\\\\n\"}}'}\n\n    def check_response(self, response: Dict[str, Any]) -> None:\n        \"\"\"Checks that a JSON response from the WebDriver does not have an\n        error.\n    \n        :Args:\n         - response - The JSON response from the WebDriver server as a dictionary\n           object.\n    \n        :Raises: If the response contains an error message.\n        \"\"\"\n        status = response.get(\"status\", None)\n        if not status or status == ErrorCode.SUCCESS:\n            return\n        value = None\n        message = response.get(\"message\", \"\")\n        screen: str = response.get(\"screen\", \"\")\n        stacktrace = None\n        if isinstance(status, int):\n            value_json = response.get(\"value\", None)\n            if value_json and isinstance(value_json, str):\n                import json\n    \n                try:\n                    value = json.loads(value_json)\n                    if len(value) == 1:\n                        value = value[\"value\"]\n                    status = value.get(\"error\", None)\n                    if not status:\n                        status = value.get(\"status\", ErrorCode.UNKNOWN_ERROR)\n                        message = value.get(\"value\") or value.get(\"message\")\n                        if not isinstance(message, str):\n                            value = message\n                            message = message.get(\"message\")\n                    else:\n                        message = value.get(\"message\", None)\n                except ValueError:\n                    pass\n    \n        exception_class: Type[WebDriverException]\n        e = ErrorCode()\n        error_codes = [item for item in dir(e) if not item.startswith(\"__\")]\n        for error_code in error_codes:\n            error_info = getattr(ErrorCode, error_code)\n            if isinstance(error_info, list) and status in error_info:\n                exception_class = getattr(ExceptionMapping, error_code, WebDriverException)\n                break\n        else:\n            exception_class = WebDriverException\n    \n        if not value:\n            value = response[\"value\"]\n        if isinstance(value, str):\n            raise exception_class(value)\n        if message == \"\" and \"message\" in value:\n            message = value[\"message\"]\n    \n        screen = None  # type: ignore[assignment]\n        if \"screen\" in value:\n            screen = value[\"screen\"]\n    \n        stacktrace = None\n        st_value = value.get(\"stackTrace\") or value.get(\"stacktrace\")\n        if st_value:\n            if isinstance(st_value, str):\n                stacktrace = st_value.split(\"\\n\")\n            else:\n                stacktrace = []\n                try:\n                    for frame in st_value:\n                        line = frame.get(\"lineNumber\", \"\")\n                        file = frame.get(\"fileName\", \"<anonymous>\")\n                        if line:\n                            file = f\"{file}:{line}\"\n                        meth = frame.get(\"methodName\", \"<anonymous>\")\n                        if \"className\" in frame:\n                            meth = f\"{frame['className']}.{meth}\"\n                        msg = \"    at %s (%s)\"\n                        msg = msg % (meth, file)\n                        stacktrace.append(msg)\n                except TypeError:\n                    pass\n        if exception_class == UnexpectedAlertPresentException:\n            alert_text = None\n            if \"data\" in value:\n                alert_text = value[\"data\"].get(\"text\")\n            elif \"alert\" in value:\n                alert_text = value[\"alert\"].get(\"text\")\n            raise exception_class(message, screen, stacktrace, alert_text)  # type: ignore[call-arg]  # mypy is not smart enough here\n>       raise exception_class(message, screen, stacktrace)\nE       selenium.common.exceptions.NoSuchWindowException: Message: no such window: target window already closed\nE       from unknown error: web view not found\nE         (Session info: chrome=142.0.7444.60)\nE       Stacktrace:\nE       Symbols not available. Dumping unresolved backtrace:\nE       \t0x7ff626c67a35\nE       \t0x7ff626c67a90\nE       \t0x7ff6269e16ad\nE       \t0x7ff6269b8e01\nE       \t0x7ff626a6a0be\nE       \t0x7ff626a8b222\nE       \t0x7ff626a2b068\nE       \t0x7ff626a2be93\nE       \t0x7ff626f229d0\nE       \t0x7ff626f1ce50\nE       \t0x7ff626f3cc45\nE       \t0x7ff626c830ce\nE       \t0x7ff626c8adbf\nE       \t0x7ff626c70c14\nE       \t0x7ff626c70dcf\nE       \t0x7ff626c56828\nE       \t0x7ffed862e8d7\nE       \t0x7ffed9e2c53c\n\nvenv\\Lib\\site-packages\\selenium\\webdriver\\remote\\errorhandler.py:229: NoSuchWindowException"}, "description": "LOGIN COMPLETO Y CAMBIO DE IDIOMA A FRANCÃ‰S DESPUÃ‰S DEL LOGIN", "attachments": [{"name": "log", "source": "4603ca44-4a2f-4efe-bec3-0af3abd72150-attachment.txt", "type": "text/plain"}, {"name": "stdout", "source": "f3d1fe9b-c534-473c-af61-9e08d5afb687-attachment.txt", "type": "text/plain"}], "start": 1762530197108, "stop": 1762530256096, "uuid": "ed093be7-1cf5-409d-b86b-dcd9a876e6b9", "historyId": "5af7df3992908c4c3c5738b5f0480f72", "testCaseId": "5af7df3992908c4c3c5738b5f0480f72", "fullName": "tests.test_case_3.TestCase3#test_login_y_cambio_idioma", "labels": [{"name": "tag", "value": "case3"}, {"name": "parentSuite", "value": "tests"}, {"name": "suite", "value": "test_case_3"}, {"name": "subSuite", "value": "TestCase3"}, {"name": "host", "value": "DESKTOP-EOEE1L3"}, {"name": "thread", "value": "12348-MainThread"}, {"name": "framework", "value": "pytest"}, {"name": "language", "value": "cpython3"}, {"name": "package", "value": "tests.test_case_3"}]}